async function calcularFrete() {
  const modelo = document.getElementById('pneuSelect').value;

  if (!modelo || !pneus[modelo]) {
    alert('Selecione um modelo de pneu válido.');
    return;
  }

  const qtd = parseInt(document.getElementById('quantidade').value);
  const origem = document.getElementById('cidadeOrigem').value;
  const destino = document.getElementById('cepDestino').value;
  const custoUn = parseFloat(document.getElementById('custoPneu').value);
  const cidade = document.getElementById('cidadeDestino').value;

  const estadoDestino = cidade.split(' - ')[1];
  const tabela = tabelasFrete[estadoDestino];

  if (!tabela) {
    alert("Tabela de frete não disponível para o estado: " + estadoDestino);
    return;
  }

  const pneu = pneus[modelo];
  const pesoRealTotal = pneu.peso * qtd;
  const volume = pneu.dimensoes.reduce((acc, val) => acc * val, 1) * qtd;
  const pesoCubadoTotal = volume * 300;
  const pesoFrete = Math.max(pesoRealTotal, pesoCubadoTotal);

  let valorKg = 0;
  for (const faixa of tabela.faixa) {
    if (pesoFrete <= faixa.limite) {
      valorKg = faixa.valorKg;
      break;
    }
  }

  if (valorKg === 0) {
    valorKg = tabela.valorExcedente / 1000;
  }

  let fretePeso = pesoFrete * valorKg;
  const valor = custoUn * qtd;
  const gris = Math.max(tabela.grisMin, valor * tabela.gris);

  let usarFreteMinimo = false;
  if (fretePeso < (tabela.tde + tabela.trt)) {
    fretePeso = 0;
    usarFreteMinimo = true;
  }

  const pedagio = tabela.pedagioPor100Kg * (pesoFrete / 100);

  const freteTotal = (usarFreteMinimo ? (tabela.tde + tabela.trt) : fretePeso)
                   + tabela.despacho
                   + tabela.tas
                   + gris
                   + (valor * tabela.adVal)
                   + pedagio;

  document.getElementById('resultado').textContent = `
Modelo: ${modelo}
Origem: ${origem}
Destino: ${cidade}
Peso total: ${pesoRealTotal.toFixed(2)} kg
Peso cubado: ${pesoCubadoTotal.toFixed(2)} kg
Peso considerado: ${pesoFrete.toFixed(2)} kg
Valor do frete estimado: R$ ${freteTotal.toFixed(2)}
  `;
}
</script>
</body>
</html>
