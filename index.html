<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Frete de Pneus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCKCV0EeLhjGGkio1-FrkBTbVBk-rP3Q74"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f9fa; padding: 20px; margin: auto; max-width: 800px; }
    h2 { text-align: center; color: #2c3e50; }
    .card { background: #fff; border-radius: 8px; padding: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-top: 20px; }
    label { font-weight: bold; margin-top: 10px; display: block; }
    input, select, button { width: 100%; padding: 10px; margin-top: 5px; border-radius: 4px; border: 1px solid #ccc; }
    button { background: #3498db; color: white; border: none; font-weight: bold; margin-top: 15px; }
    button:hover { background: #2980b9; }
    .resultado { margin-top: 20px; background: #ecf0f1; border-left: 5px solid #3498db; padding: 15px; font-size: 14px; }
    .erro { color: red; }
    @media (max-width: 600px) { .card { padding: 10px; } input, select, button { font-size: 14px; } }
  </style>
</head>
<body>
<h2>Calculadora de Frete de Pneus</h2>
<div class="card">
  <label for="tipoOrigem">Origem do Frete:</label>
  <select id="tipoOrigem">
    <option value="fixo">Usar endereço fixo (Navegantes - SC)</option>
    <option value="manual">Inserir outro CEP</option>
  </select>
  <div id="origemManualContainer" style="display:none;">
    <label for="origemManual">CEP de Origem:</label>
    <input type="text" id="origemManual" placeholder="00000000" maxlength="9">
  </div>
  <label for="destino">CEP de Destino:</label>
  <input type="text" id="destino" placeholder="00000000" maxlength="9">
  <label for="medida">Medida do Pneu:</label>
  <select id="medida">
    <option value="">-- Escolha uma medida --</option>
    <option>165/70R13</option>
    <option>175/65R14</option>
    <option>195/60R15</option>
    <option>205/55R16</option>
    <option>225/75R16</option>
  </select>
  <label for="quantidade">Quantidade de Pneus:</label>
  <input type="number" id="quantidade" value="4" min="1">
  <label for="valorUnitario">Valor Unitário (R$) do Pneu:</label>
  <input type="number" id="valorUnitario" placeholder="Ex: 250" step="0.01" min="0">
  <button onclick="calcularFreteLogdi()">Calcular Frete</button>
  <button onclick="gerarPDF()">Gerar PDF</button>
  <div class="resultado" id="resultado"></div>
</div>

<script>
const tabelasFrete = {
  "PA": { faixas: [30, 50, 70, 100], valores: [99.10, 112.69, 143.79, 194.30], excedente: 1713.60 },
  "BA": { faixas: [30, 50, 70, 100], valores: [113.47, 129.04, 164.64, 222.49], excedente: 1892.80 },
  "CE": { faixas: [30, 50, 70, 100], valores: [130.86, 148.83, 189.88, 256.59], excedente: 2049.60 },
  "DF": { faixas: [30, 50, 70, 100], valores: [71.86, 81.73, 104.27, 140.91], excedente: 1075.20 },
  "ES": { faixas: [30, 50, 70, 100], valores: [76.71, 87.24, 111.29, 150.39], excedente: 1366.40 },
  "GO": { faixas: [30, 50, 70, 100], valores: [76.71, 87.24, 111.29, 150.39], excedente: 1276.80 },
  "MA": { faixas: [30, 50, 70, 100], valores: [148.27, 168.62, 215.13, 290.71], excedente: 2318.40 },
  "MG": { faixas: [30, 50, 70, 100], valores: [76.71, 87.24, 111.29, 150.39], excedente: 1243.20 },
  "MS": { faixas: [30, 50, 70, 100], valores: [85.48, 97.22, 124.03, 167.61], excedente: 1579.20 },
  "MT": { faixas: [30, 50, 70, 100], valores: [113.47, 129.04, 164.64, 222.49], excedente: 1960.00 },
  "PB": { faixas: [30, 50, 70, 100], valores: [120.28, 136.79, 174.52, 235.83], excedente: 2016.00 },
  "PE": { faixas: [30, 50, 70, 100], valores: [118.00, 134.20, 171.23, 231.38], excedente: 1982.40 },
  "PI": { faixas: [30, 50, 70, 100], valores: [148.27, 168.62, 215.13, 290.71], excedente: 2318.40 },
  "PR": { faixas: [30, 50, 70, 100], valores: [58.96, 67.05, 87.79, 115.61], excedente: 1019.20 },
  "RJ": { faixas: [30, 50, 70, 100], valores: [63.24, 71.92, 91.76, 124.00], excedente: 1243.20 },
  "RN": { faixas: [30, 50, 70, 100], valores: [117.25, 133.35, 170.13, 229.90], excedente: 1971.20 },
  "RS": { faixas: [30, 50, 70, 100], valores: [76.70, 87.24, 111.29, 150.39], excedente: 1243.20 },
  "SC": { faixas: [30, 50, 70, 100], valores: [64.90, 73.81, 94.17, 127.27], excedente: 1008.00 },
  "SE": { faixas: [30, 50, 70, 100], valores: [113.47, 129.04, 164.64, 222.49], excedente: 1780.80 },
  "SP": { faixas: [30, 50, 70, 100], valores: [76.71, 87.24, 111.29, 150.39], excedente: 1411.20 },
  "TO": { faixas: [30, 50, 70, 100], valores: [118.00, 134.20, 171.23, 231.38], excedente: 1982.40 }
};

function calcularFreteLogdi() {
  const tipoOrigem = document.getElementById('tipoOrigem').value;
  const origem = tipoOrigem === 'manual' ? document.getElementById('origemManual').value + ', Brasil' : 'R. Santos Maccarini, 650 - Machados, Navegantes - SC, 88375-000';
  const destino = document.getElementById('destino').value;
  const medida = document.getElementById('medida').value;
  const qtd = parseInt(document.getElementById('quantidade').value);
  const valorUnit = parseFloat(document.getElementById('valorUnitario').value);

  if (!medida || !destino || qtd <= 0 || !valorUnit || (tipoOrigem === 'manual' && !document.getElementById('origemManual').value)) {
    resultado.innerHTML = '<span class="erro">Preencha todos os campos corretamente.</span>';
    return;
  }

  fetch(`https://viacep.com.br/ws/${destino.replace(/[^0-9]/g, '')}/json/`)
    .then(res => res.json())
    .then(data => {
      const estado = data.uf;
      if (!tabelasFrete[estado]) {
        resultado.innerHTML = '<span class="erro">Estado de destino não suportado na tabela de frete.</span>';
        return;
      }
      calcularDistancia(origem, destino + ', Brasil', (erro, distancia) => {
        if (erro) {
          resultado.innerHTML = '<span class="erro">' + erro + '</span>';
          return;
        }

        const valorNF = qtd * valorUnit;
        const volumeUnit = 0.74 * 0.74 * 0.225;
        const pesoReal = 17.7 * qtd;
        const pesoCubado = volumeUnit * 300 * qtd;
        const pesoTarifado = Math.max(pesoReal, pesoCubado);

        const tabela = tabelasFrete[estado];
        let fretePeso = 0;
        if (pesoTarifado <= tabela.faixas[0]) fretePeso = tabela.valores[0] * pesoTarifado;
        else if (pesoTarifado <= tabela.faixas[1]) fretePeso = tabela.valores[1] * pesoTarifado;
        else if (pesoTarifado <= tabela.faixas[2]) fretePeso = tabela.valores[2] * pesoTarifado;
        else if (pesoTarifado <= tabela.faixas[3]) fretePeso = tabela.valores[3] * pesoTarifado;
        else fretePeso = (pesoTarifado / 1000) * tabela.excedente;

        fretePeso = Math.max(fretePeso, 280);
        const pedagio = Math.ceil(pesoTarifado / 100) * 4.69;
        const gris = Math.max(0.002 * valorNF, 4.97);
        const freteValor = 0.0051 * valorNF;
        const total = fretePeso + 82 + 17.45 + 4.70 + pedagio + gris + freteValor;

        resultado.innerHTML = `
          <strong>Destino:</strong> ${data.localidade} - ${estado}<br>
          <strong>Distância:</strong> ${distancia.toFixed(1)} km<br>
          <strong>Medida:</strong> ${medida}<br>
          <strong>Peso Real:</strong> ${pesoReal.toFixed(1)} kg<br>
          <strong>Peso Cubado:</strong> ${pesoCubado.toFixed(1)} kg<br>
          <strong>Peso Tarifado:</strong> ${pesoTarifado.toFixed(1)} kg<br>
          <strong>Frete Peso:</strong> R$ ${fretePeso.toFixed(2)}<br>
          <strong>Pedágio:</strong> R$ ${pedagio.toFixed(2)}<br>
          <strong>GRIS:</strong> R$ ${gris.toFixed(2)}<br>
          <strong>Frete Valor:</strong> R$ ${freteValor.toFixed(2)}<br>
          <strong>Total:</strong> <strong style="color:#2c3e50;">R$ ${total.toFixed(2)}</strong>`;
      });
    });
}

function calcularDistancia(origem, destino, callback) {
  const service = new google.maps.DistanceMatrixService();
  service.getDistanceMatrix({
    origins: [origem],
    destinations: [destino],
    travelMode: 'DRIVING',
    unitSystem: google.maps.UnitSystem.METRIC
  }, function(response, status) {
    if (status === 'OK') {
      const dist = response.rows[0].elements[0];
      if (dist.status === 'OK') {
        callback(null, dist.distance.value / 1000);
      } else {
        callback('Distância não encontrada.', null);
      }
    } else {
      callback('Erro na API.', null);
    }
  });
}

function gerarPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const content = document.getElementById('resultado').innerText;
  doc.text(content, 10, 10);
  doc.save('frete-pneus.pdf');
}
</script>
</body>
</html>
