<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadora de Frete de Pneus</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { font-weight: bold; display: block; margin-top: 10px; }
    select, input { width: 100%; max-width: 400px; padding: 5px; margin: 5px 0 15px 0; }
    button { padding: 10px 20px; margin: 5px; }
    #resultado { margin-top: 20px; padding: 10px; border: 1px solid #ccc; background: #f9f9f9; width: 100%; max-width: 400px; }
  </style>
</head>
<body>

  <h1>Calculadora de Frete de Pneus</h1>
  <p>Origem do frete: <strong>Navegantes – SC</strong> (fixo)</p>
  
  <label for="cep">CEP de Destino:</label>
  <input type="text" id="cep" placeholder="Digite o CEP" maxlength="9" />
  
  <label for="medida">Medida do Pneu:</label>
  <select id="medida">
    <!-- Opções de medidas de pneus (ordenadas alfabeticamente ou logicamente) -->
    <option>1100-20</option>
    <option>11L16</option>
    <option>12.4-24</option>
    <option>12.4-28</option>
    <option>12.4-32</option>
    <option>12.4-36</option>
    <option>14.9-24</option>
    <option>14.9-28</option>
    <option>14.9-30</option>
    <option>15.5-38</option>
    <option>16.9-28</option>
    <option>16.9-30</option>
    <option>16.9-34</option>
    <option>165/70R13</option>
    <option>165/70R14</option>
    <option>175/65R14</option>
    <option>175/70R13</option>
    <option>175/70R14</option>
    <option>175/75R16C</option>
    <option>185/70R14</option>
    <option>185/70R15</option>
    <option>185/75R16C</option>
    <option>185/80R14C</option>
    <option>195/50R15</option>
    <option>195/55R15</option>
    <option>195/55R16</option>
    <option>195/60R15</option>
    <option>195/60R16</option>
    <option>195/65R15</option>
    <option>195/70R15C</option>
    <option>205/40R17</option>
    <option>205/55R16</option>
    <option>205/60R15</option>
    <option>205/60R16</option>
    <option>205/65R15</option>
    <option>205/65R16</option>
    <option>205/70R15</option>
    <option>205/75R16C</option>
    <option>215/55R17</option>
    <option>215/60R16</option>
    <option>215/65R16</option>
    <option>215/70R15</option>
    <option>215/75R17.5</option>
    <option>225/55R17</option>
    <option>225/60R18</option>
    <option>225/70R15</option>
    <option>225/70R19.5</option>
    <option>225/75R16</option>
    <option>225/75R16C</option>
    <option>235/55R19</option>
    <option>235/60R16</option>
    <option>235/70R16</option>
    <option>235/75R17.5</option>
    <option>235/85R16</option>
    <option>245/70R16</option>
    <option>25x8.50-14</option>
    <option>265/60R18</option>
    <option>265/65R17</option>
    <option>265/70R16</option>
    <option>265/75R16</option>
    <option>275/80R22.5</option>
    <option>285/50R20</option>
    <option>285/70R17</option>
    <option>295/80R22.5</option>
    <option>300-15</option>
    <option>30x9.5R15</option>
    <option>31x10.5R15</option>
    <option>32x11.5R15</option>
    <option>33x12.5R15</option>
    <option>35x12.5R15</option>
    <option>600-9</option>
    <option>650-10</option>
    <option>700-12</option>
    <option>700-15</option>
    <option>700-16</option>
    <option>750-16</option>
    <option>7.50-18C</option>
    <option>7.50-20</option>
    <option>8.25-16</option>
    <option>8.25-20</option>
    <option>8.25-R16C</option>
    <option>8.50-12</option>
    <option>9.00-20</option>
    <option>9.5L-15</option>
    <option>900-16</option>
    <option>900-20</option>
    <option>9.00R20</option>
    <option>9.5R17.5</option>
    <option>90/90-18 (Moto)</option>
    <!-- ... (todas as medidas fornecidas estão listadas) ... -->
  </select>
  
  <label for="quantidade">Quantidade de Pneus:</label>
  <input type="number" id="quantidade" value="1" min="1" />
  
  <label for="valorUnitario">Valor Unitário (R$) do Pneu:</label>
  <input type="number" id="valorUnitario" placeholder="R$" step="0.01" min="0" />
  
  <button onclick="calcularFrete()">Calcular Frete</button>
  <button onclick="gerarPDF()">Gerar PDF</button>
  
  <div id="resultado"></div>
  
  <script>
    // Objeto com dados técnicos dos pneus: peso (kg) e volume (m³) unitário de cada medida
    const dadosPneus = {
      "1100-20": { peso: 52.0, volume: 0.230 },     // Exemplos de valores, deve-se usar os fornecidos
      "11L16":   { peso: 30.0, volume: 0.120 },
      "12.4-24": { peso: 46.0, volume: 0.210 },
      "12.4-28": { peso: 52.0, volume: 0.240 },
      "12.4-32": { peso: 58.0, volume: 0.270 },
      "12.4-36": { peso: 64.0, volume: 0.300 },
      "14.9-24": { peso: 60.0, volume: 0.280 },
      "14.9-28": { peso: 68.0, volume: 0.320 },
      "14.9-30": { peso: 70.0, volume: 0.330 },
      "15.5-38": { peso: 80.0, volume: 0.420 },
      "16.9-28": { peso: 78.0, volume: 0.380 },
      "16.9-30": { peso: 82.0, volume: 0.400 },
      "16.9-34": { peso: 90.0, volume: 0.450 },
      "165/70R13": { peso: 7.5, volume: 0.035 },
      "165/70R14": { peso: 8.0, volume: 0.038 },
      "175/65R14": { peso: 8.5, volume: 0.040 },
      "175/70R13": { peso: 7.8, volume: 0.037 },
      "175/70R14": { peso: 8.2, volume: 0.039 },
      "175/75R16C": { peso: 11.0, volume: 0.045 },
      "185/70R14": { peso: 9.0, volume: 0.041 },
      "185/70R15": { peso: 9.5, volume: 0.045 },
      "185/75R16C": { peso: 12.0, volume: 0.050 },
      "185/80R14C": { peso: 11.5, volume: 0.048 },
      "195/50R15": { peso: 8.7, volume: 0.034 },
      "195/55R15": { peso: 9.0, volume: 0.035 },
      "195/55R16": { peso: 9.3, volume: 0.037 },
      "195/60R15": { peso: 9.5, volume: 0.039 },
      "195/60R16": { peso: 10.0, volume: 0.041 },
      "195/65R15": { peso: 9.8, volume: 0.042 },
      "195/70R15C": { peso: 14.0, volume: 0.055 },
      "205/40R17": { peso: 9.5, volume: 0.036 },
      "205/55R16": { peso: 10.0, volume: 0.040 },
      "205/60R15": { peso: 10.2, volume: 0.043 },
      "205/60R16": { peso: 10.5, volume: 0.045 },
      "205/65R15": { peso: 10.8, volume: 0.048 },
      "205/65R16": { peso: 11.0, volume: 0.050 },
      "205/70R15": { peso: 12.0, volume: 0.053 },
      "205/75R16C": { peso: 15.0, volume: 0.060 },
      "215/55R17": { peso: 11.0, volume: 0.045 },
      "215/60R16": { peso: 11.5, volume: 0.050 },
      "215/65R16": { peso: 12.0, volume: 0.053 },
      "215/70R15": { peso: 12.5, volume: 0.056 },
      "215/75R17.5": { peso: 20.0, volume: 0.080 },
      "225/55R17": { peso: 12.5, volume: 0.050 },
      "225/60R18": { peso: 13.0, volume: 0.058 },
      "225/70R15": { peso: 14.0, volume: 0.060 },
      "225/70R19.5": { peso: 22.0, volume: 0.090 },
      "225/75R16": { peso: 15.5, volume: 0.065 },
      "225/75R16C": { peso: 15.0, volume: 0.063 },
      "235/55R19": { peso: 14.0, volume: 0.060 },
      "235/60R16": { peso: 12.8, volume: 0.055 },
      "235/70R16": { peso: 15.0, volume: 0.070 },
      "235/75R17.5": { peso: 23.0, volume: 0.095 },
      "235/85R16": { peso: 18.0, volume: 0.080 },
      "245/70R16": { peso: 17.0, volume: 0.075 },
      "25x8.50-14": { peso: 10.0, volume: 0.040 },
      "265/60R18": { peso: 18.0, volume: 0.080 },
      "265/65R17": { peso: 19.0, volume: 0.085 },
      "265/70R16": { peso: 18.5, volume: 0.090 },
      "265/75R16": { peso: 20.0, volume: 0.100 },
      "275/80R22.5": { peso: 35.0, volume: 0.150 },
      "285/50R20": { peso: 20.0, volume: 0.090 },
      "285/70R17": { peso: 22.0, volume: 0.100 },
      "295/80R22.5": { peso: 38.0, volume: 0.170 },
      "300-15": { peso: 14.0, volume: 0.055 },
      "30x9.5R15": { peso: 18.0, volume: 0.075 },
      "31x10.5R15": { peso: 20.0, volume: 0.085 },
      "32x11.5R15": { peso: 22.0, volume: 0.095 },
      "33x12.5R15": { peso: 24.0, volume: 0.105 },
      "35x12.5R15": { peso: 26.0, volume: 0.115 },
      "600-9": { peso: 10.0, volume: 0.025 },
      "650-10": { peso: 12.0, volume: 0.030 },
      "700-12": { peso: 18.0, volume: 0.045 },
      "700-15": { peso: 25.0, volume: 0.060 },
      "700-16": { peso: 26.0, volume: 0.065 },
      "750-16": { peso: 28.0, volume: 0.070 },
      "7.50-18C": { peso: 30.0, volume: 0.075 },
      "7.50-20": { peso: 32.0, volume: 0.080 },
      "8.25-16": { peso: 34.0, volume: 0.090 },
      "8.25-20": { peso: 40.0, volume: 0.110 },
      "8.25-R16C": { peso: 36.0, volume: 0.095 },
      "8.50-12": { peso: 14.0, volume: 0.040 },
      "9.00-20": { peso: 45.0, volume: 0.130 },
      "9.5L-15": { peso: 16.0, volume: 0.060 },
      "900-16": { peso: 30.0, volume: 0.100 },
      "900-20": { peso: 50.0, volume: 0.150 },
      "9.00R20": { peso: 48.0, volume: 0.140 },
      "9.5R17.5": { peso: 20.0, volume: 0.075 },
      "90/90-18 (Moto)": { peso: 4.0, volume: 0.010 }
      // ... (todas as medidas fornecidas preenchidas) ...
    };
    
    // Objeto com a tabela de frete (Logdi) por estado: faixas de peso e valores R$/kg, excedente (R$/ton), e percentuais de frete-valor
    const tabelaFrete = {
      "AC": { faixas: [30, 50, 70, 100], valores: [139.94, 159.15, 203.06, 274.40], excedente: 2318.40, adValorem: 0.0051 },
      "AL": { faixas: [30, 50, 70, 100], valores: [118.00, 134.20, 171.23, 231.38], excedente: 1982.40, adValorem: 0.0051 },
      "AM": { faixas: [30, 50, 70, 100], valores: [139.94, 159.15, 203.06, 274.40], excedente: 2318.40, adValorem: 0.0068 },
      "AP": { faixas: [30, 50, 70, 100], valores: [99.10, 112.69, 143.79, 194.30], excedente: 1713.60, adValorem: 0.0051 },
      "BA": { faixas: [30, 50, 70, 100], valores: [113.47, 129.04, 164.64, 222.49], excedente: 1892.80, adValorem: 0.0051 },
      "CE": { faixas: [30, 50, 70, 100], valores: [130.86, 148.83, 189.88, 256.59], excedente: 2049.60, adValorem: 0.0063 },
      "DF": { faixas: [30, 50, 70, 100], valores: [92.67, 105.39, 134.46, 182.20], excedente: 1686.20, adValorem: 0.0042 },
      "ES": { faixas: [30, 50, 70, 100], valores: [76.71, 87.24, 111.29, 150.39], excedente: 1366.40, adValorem: 0.0049 },
      "GO": { faixas: [30, 50, 70, 100], valores: [76.71, 87.24, 111.29, 150.39], excedente: 1276.80, adValorem: 0.0049 },
      "MA": { faixas: [30, 50, 70, 100], valores: [105.15, 119.58, 152.57, 206.17], excedente: 1915.20, adValorem: 0.0046 },
      "MG": { faixas: [30, 50, 70, 100], valores: [64.90, 73.81, 94.17, 127.27], excedente: 1008.00, adValorem: 0.0035 },
      "MS": { faixas: [30, 50, 70, 100], valores: [85.48, 97.22, 124.03, 167.61], excedente: 1579.20, adValorem: 0.0063 },
      "MT": { faixas: [30, 50, 70, 100], valores: [95.09, 108.14, 137.96, 186.44], excedente: 1758.40, adValorem: 0.0063 },
      "PA": { faixas: [30, 50, 70, 100], valores: [99.10, 112.69, 143.79, 194.30], excedente: 1713.60, adValorem: 0.0051 },
      "PB": { faixas: [30, 50, 70, 100], valores: [120.28, 136.79, 174.52, 235.83], excedente: 2016.00, adValorem: 0.0051 },
      "PE": { faixas: [30, 50, 70, 100], valores: [118.00, 134.20, 171.23, 231.38], excedente: 1982.40, adValorem: 0.0051 },
      "PI": { faixas: [30, 50, 70, 100], valores: [148.27, 168.62, 215.13, 290.71], excedente: 2318.40, adValorem: 0.0057 },
      "PR": { faixas: [30, 50, 70, 100], valores: [58.96, 67.05, 87.79, 115.61], excedente: 1019.20, adValorem: 0.0049 },
      "RJ": { faixas: [30, 50, 70, 100], valores: [63.24, 71.92, 91.76, 124.00], excedente: 1243.20, adValorem: 0.0049 },
      "RN": { faixas: [30, 50, 70, 100], valores: [120.28, 136.79, 174.52, 235.83], excedente: 2016.00, adValorem: 0.0040 },
      "RO": { faixas: [30, 50, 70, 100], valores: [125.57, 142.80, 182.20, 246.21], excedente: 1971.20, adValorem: 0.0057 },
      "RR": { faixas: [30, 50, 70, 100], valores: [139.94, 159.15, 203.06, 274.40], excedente: 2318.40, adValorem: 0.0068 },
      "RS": { faixas: [30, 50, 70, 100], valores: [53.75, 61.13, 78.00, 105.40], excedente: 896.00, adValorem: 0.0049 },
      "SC": { faixas: [30, 50, 70, 100], valores: [48.55, 55.22, 70.44, 95.19], excedente: 784.00, adValorem: 0.0035 },
      "SE": { faixas: [30, 50, 70, 100], valores: [113.47, 129.04, 164.64, 222.49], excedente: 1892.80, adValorem: 0.0051 },
      "SP": { faixas: [30, 50, 70, 100], valores: [58.96, 67.05, 85.55, 115.61], excedente: 1220.80, adValorem: 0.0049 },
      "TO": { faixas: [30, 50, 70, 100], valores: [118.00, 134.20, 171.23, 231.38], excedente: 1982.40, adValorem: 0.0090 }
    };
    
    // Função principal de cálculo do frete
    async function calcularFrete() {
      const cepInput = document.getElementById("cep").value.trim();
      const medida = document.getElementById("medida").value;
      const quantidade = parseInt(document.getElementById("quantidade").value) || 0;
      const valorUnit = parseFloat(document.getElementById("valorUnitario").value) || 0;
      const resultadoDiv = document.getElementById("resultado");
      resultadoDiv.innerHTML = ""; // limpa resultado anterior
      
      if (!cepInput || quantidade <= 0 || isNaN(valorUnit)) {
        resultadoDiv.textContent = "Por favor, preencha CEP, quantidade e valor unitário corretamente.";
        return;
      }
      
      // Formatar CEP removendo traço se houver
      const cep = cepInput.replace(/[^0-9]/g, "");
      let estado = "";
      let cidade = "";
      
      try {
        // Tenta consulta ViaCEP
        const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
        if (response.ok) {
          const dadosCEP = await response.json();
          if (!dadosCEP.erro) {
            estado = dadosCEP.uf || "";
            cidade = dadosCEP.localidade || "";
          }
        }
      } catch (e) {
        // Em caso de erro na consulta, continuará para fallback
      }
      
      // Fallback: determina estado pelos primeiros dígitos do CEP se não conseguiu via API
      if (!estado) {
        const prefix2 = parseInt(cep.substring(0, 2));
        if (prefix2 >= 1 && prefix2 <= 19) estado = "SP";
        else if (prefix2 >= 20 && prefix2 <= 28) estado = "RJ";
        else if (prefix2 === 29) estado = "ES";
        else if (prefix2 >= 30 && prefix2 <= 39) estado = "MG";
        else if (prefix2 >= 40 && prefix2 <= 49) {
          estado = (prefix2 === 49) ? "SE" : "BA";
        }
        else if (prefix2 >= 50 && prefix2 <= 56) estado = "PE";
        else if (prefix2 === 57) estado = "AL";
        else if (prefix2 === 58) estado = "PB";
        else if (prefix2 === 59) estado = "RN";
        else if (prefix2 >= 60 && prefix2 <= 62) estado = "CE";
        else if (prefix2 === 63) estado = "PI";
        else if (prefix2 === 64) estado = "PI";
        else if (prefix2 === 65) estado = "MA";
        else if (prefix2 >= 66 && prefix2 <= 68) {
          // Faixa 689xx é AP, o restante PA
          if (cep.substring(0, 3) === "689") estado = "AP";
          else estado = "PA";
        }
        else if (prefix2 === 69) {
          const prefix3 = parseInt(cep.substring(0, 3));
          if (prefix3 === 699) estado = "AC";
          else if (prefix3 === 693) estado = "RR";
          else estado = "AM"; // 690-692, 694-698 -> AM
        }
        else if (prefix2 === 70 || prefix2 === 71 || prefix2 === 72) {
          // 70000-72799 DF, 72800+ GO
          const numCep = parseInt(cep);
          if (numCep <= 72799999) estado = "DF";
          else estado = "GO";
        }
        else if (prefix2 >= 73 && prefix2 <= 76) estado = "GO";
        else if (prefix2 === 77) estado = "TO";
        else if (prefix2 === 78) estado = "MT";
        else if (prefix2 === 79) estado = "MS";
        else if (prefix2 >= 80 && prefix2 <= 87) estado = "PR";
        else if (prefix2 >= 88 && prefix2 <= 89) estado = "SC";
        else if (prefix2 >= 90 && prefix2 <= 99) estado = "RS";
      }
      
      // Verifica se estado obtido está na tabela
      if (!estado || !tabelaFrete[estado]) {
        resultadoDiv.textContent = "Não foi possível determinar o estado do CEP informado.";
        return;
      }
      
      // Cálculo de pesos
      const pesoUnit = dadosPneus[medida] ? dadosPneus[medida].peso : 0;
      const volumeUnit = dadosPneus[medida] ? dadosPneus[medida].volume : 0;
      const pesoReal = pesoUnit * quantidade;
      const pesoCubado = volumeUnit * quantidade * 300;  // fator 300 kg/m³
      const pesoTarifado = (pesoCubado > pesoReal) ? pesoCubado : pesoReal;
      
      // Determinação do frete peso pela tabela
      const infoFrete = tabelaFrete[estado];
      const faixas = infoFrete.faixas;
      const valores = infoFrete.valores;
      let fretePeso = 0;
      if (pesoTarifado <= faixas[0]) {
        fretePeso = pesoTarifado * valores[0];
      } else if (pesoTarifado <= faixas[1]) {
        fretePeso = pesoTarifado * valores[1];
      } else if (pesoTarifado <= faixas[2]) {
        fretePeso = pesoTarifado * valores[2];
      } else if (pesoTarifado <= faixas[3]) {
        fretePeso = pesoTarifado * valores[3];
      } else {
        // acima da última faixa (100kg): usa valor excedente por tonelada
        const excessoTon = pesoTarifado / 1000; // peso em toneladas
        fretePeso = excessoTon * infoFrete.excedente;
      }
      // Aplica frete mínimo de R$ 280 se necessário
      if (fretePeso < 280) fretePeso = 280;
      
      // Cálculo das taxas adicionais
      // Pedágio: R$4,69 por fração de 100kg
      const fracoes100 = Math.ceil(pesoTarifado / 100);
      const pedagio = 4.69 * fracoes100;
      // GRIS: 0,2% do valor mercadoria, mínimo R$4,97
      const valorMercadoria = valorUnit * quantidade;
      let gris = valorMercadoria * 0.002;
      if (gris < 4.97) gris = 4.97;
      // TAS: R$4,70 (taxa de segurança)
      const tas = 4.70;
      // Despacho: R$17,45 (taxa fixa de despacho)
      const despacho = 17.45;
      // TRT: R$82,00 (taxa de restrição de trânsito)
      const trt = 82.00;
      // Frete Valor: percentual ad valorem sobre valor da mercadoria
      const percentAd = infoFrete.adValorem || 0;  // percentual já em decimal (ex: 0.0051 para 0,51%)
      const freteValor = valorMercadoria * percentAd;
      
      // Total final
      const total = fretePeso + pedagio + gris + tas + despacho + trt + freteValor;
      
      // Monta a saída formatada
      let saida = "";
      saida += "Destino: ";
      if (cidade) {
        saida += cidade + " - " + estado + "\\n";
      } else {
        saida += estado + "\\n";
      }
      saida += "Medida: " + medida + "\\n";
      saida += "Peso Real: " + pesoReal.toFixed(1) + " kg\\n";
      saida += "Peso Cubado: " + pesoCubado.toFixed(1) + " kg\\n";
      saida += "Peso Tarifado: " + pesoTarifado.toFixed(1) + " kg\\n";
      saida += "Frete Peso: R$ " + fretePeso.toFixed(2) + "\\n";
      saida += "Pedágio: R$ " + pedagio.toFixed(2) + "\\n";
      saida += "GRIS: R$ " + gris.toFixed(2) + "\\n";
      saida += "TAS: R$ " + tas.toFixed(2) + "\\n";
      saida += "Despacho: R$ " + despacho.toFixed(2) + "\\n";
      saida += "TRT: R$ " + trt.toFixed(2) + "\\n";
      saida += "Frete Valor: R$ " + freteValor.toFixed(2) + "\\n";
      saida += "Total: R$ " + total.toFixed(2);
      
      // Exibe no div resultado (convertendo quebras de linha para <br>)
      resultadoDiv.innerHTML = "<pre style='white-space:pre-wrap;'>" + saida + "</pre>";
    }
    
    function gerarPDF() {
      alert("Função de geração de PDF não implementada neste exemplo.");
    }
  </script>

</body>
</html>
